(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     58097,       1326]
NotebookOptionsPosition[     56331,       1292]
NotebookOutlinePosition[     56695,       1308]
CellTagsIndexPosition[     56652,       1305]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{"Quit", "[", "]"}]], "Input",
 CellChangeTimes->{{3.799589148514045*^9, 3.799589150972974*^9}},
 CellLabel->
  "In[217]:=",ExpressionUUID->"7430b8b9-b19a-4e74-a9b9-43795df7ac79"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Get", "[", "\"\<../../ltd_math_utils/LTDTools.m\>\"", 
  "]"}]], "Input",
 CellChangeTimes->{{3.7993095024725018`*^9, 3.7993095361897306`*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"4d4c8083-9752-4e77-8071-eccbd0a7ddbe"],

Cell[CellGroupData[{

Cell[BoxData["\<\"The documented functions in this package are: \\n \
?constructCuts \\n ?createSuperGraph \\n ?exportAmplitude \\n \
?extractTensCoeff \\n ?findIsomorphicGraphs \\n ?getCutStructure \\n \
?getLoopLines \\n ?getSymCoeff \\n ?getSymCoeffSP \\n ?importGraphs \\n \
?plotGraph \\n ?processNumerator \\n ?writeMinimalJSON \\n ?writeLTDSqrtJSON \
\\n ?translateToFeynCalc\\n ----------------------------------------- \\n \
Needs the package FeynCalc which can installed with \
Import[\\\"https://raw.githubusercontent.com/FeynCalc/feyncalc/master/install.\
m\\\"]; InstallFeynCalc[]\\n Needs the package IGraphM which can be \
downloaded from https://github.com/szhorvat/IGraphM. !!! \\n Run: \
Get[\\\"https://raw.githubusercontent.com/szhorvat/IGraphM/master/IGInstaller.\
m\\\"] for installation. \"\>"], "Print",
 CellChangeTimes->{3.7995969684369287`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"2e3421f8-8d53-44db-9bdb-d5ad04144798"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   StyleBox["\<\"FeynCalc \"\>", "Text",
    StripOnInput->False,
    FontWeight->Bold], "\[InvisibleSpace]", 
   StyleBox["\<\"9.3.0 (stable version). For help, use the \"\>", "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox[
    TagBox[
     ButtonBox[
      RowBox[{"documentation", " ", "center"}],
      BaseStyle->"Link",
      ButtonData:>"paclet:FeynCalc/",
      ButtonNote->"paclet:FeynCalc/"],
     DisplayForm], "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox["\<\", check out the \"\>", "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox[
    TagBox[
     ButtonBox["wiki",
      BaseStyle->"Hyperlink",
      ButtonData:>{
        URL["https://github.com/FeynCalc/feyncalc/wiki"], None},
      ButtonNote->"https://github.com/FeynCalc/feyncalc/wiki"],
     DisplayForm], "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox["\<\" or write to the \"\>", "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox[
    TagBox[
     ButtonBox[
      RowBox[{"mailing", " ", 
       RowBox[{"list", "."}]}],
      BaseStyle->"Hyperlink",
      ButtonData:>{
        URL["http://www.feyncalc.org/forum/"], None},
      ButtonNote->"http://www.feyncalc.org/forum/"],
     DisplayForm], "Text",
    StripOnInput->False]}],
  SequenceForm[
   Style["FeynCalc ", "Text", Bold], 
   Style["9.3.0 (stable version). For help, use the ", "Text"], 
   Style[
    DisplayForm[
     ButtonBox[
     "documentation center", BaseStyle -> "Link", ButtonData :> 
      "paclet:FeynCalc/", ButtonNote -> "paclet:FeynCalc/"]], "Text"], 
   Style[", check out the ", "Text"], 
   Style[
    DisplayForm[
     ButtonBox["wiki", ButtonData :> {
        URL["https://github.com/FeynCalc/feyncalc/wiki"], None}, BaseStyle -> 
      "Hyperlink", ButtonNote -> 
      "https://github.com/FeynCalc/feyncalc/wiki"]], "Text"], 
   Style[" or write to the ", "Text"], 
   Style[
    DisplayForm[
     ButtonBox["mailing list.", ButtonData :> {
        URL["http://www.feyncalc.org/forum/"], None}, BaseStyle -> 
      "Hyperlink", ButtonNote -> "http://www.feyncalc.org/forum/"]], "Text"]],
  
  Editable->False]], "Print",
 CellChangeTimes->{3.7995969728742*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"5b4e9382-fab7-4657-b15a-de481239a631"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   StyleBox["\<\"To save your and our time, please check our \"\>", "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox[
    TagBox[
     ButtonBox["FAQ",
      BaseStyle->"Hyperlink",
      ButtonData:>{
        URL["https://github.com/FeynCalc/feyncalc/wiki/FAQ"], None},
      ButtonNote->"https://github.com/FeynCalc/feyncalc/wiki"],
     DisplayForm], "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox["\<\" for answers to some common FeynCalc questions.\"\>", "Text",
    
    StripOnInput->False]}],
  SequenceForm[
   Style["To save your and our time, please check our ", "Text"], 
   Style[
    DisplayForm[
     ButtonBox["FAQ", ButtonData :> {
        URL["https://github.com/FeynCalc/feyncalc/wiki/FAQ"], None}, 
      BaseStyle -> "Hyperlink", ButtonNote -> 
      "https://github.com/FeynCalc/feyncalc/wiki"]], "Text"], 
   Style[" for answers to some common FeynCalc questions.", "Text"]],
  Editable->False]], "Print",
 CellChangeTimes->{3.799596972937649*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"83f4bf1f-98de-4205-9c71-b0a8b642242a"],

Cell[BoxData[
 InterpretationBox[
  RowBox[{
   StyleBox["\<\"See also the supplied \"\>", "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox[
    TagBox[
     ButtonBox[
      RowBox[{"examples", "."}],
      BaseStyle->"Hyperlink",
      ButtonFunction:>SystemOpen[
        FileNameJoin[{FeynCalc`$FeynCalcDirectory, "Examples"}]],
      Evaluator->Automatic,
      Method->"Preemptive"],
     DisplayForm], "Text",
    StripOnInput->False], "\[InvisibleSpace]", 
   StyleBox["\<\" If you use FeynCalc in your research, please cite\"\>", 
    "Text",
    StripOnInput->False]}],
  SequenceForm[
   Style["See also the supplied ", "Text"], 
   Style[
    DisplayForm[
     ButtonBox[
     "examples.", BaseStyle -> "Hyperlink", ButtonFunction :> SystemOpen[
        FileNameJoin[{FeynCalc`$FeynCalcDirectory, "Examples"}]], Evaluator -> 
      Automatic, Method -> "Preemptive"]], "Text"], 
   Style[" If you use FeynCalc in your research, please cite", "Text"]],
  Editable->False]], "Print",
 CellChangeTimes->{3.799596972940289*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"7d8b3c0c-16dc-4316-ae79-2b9f6ae296dc"],

Cell[BoxData[
 StyleBox["\<\" \[Bullet] V. Shtabovenko, R. Mertig and F. Orellana, \
P3H-20-002, TTP19-020, TUM-EFT 130/19, arXiv:2001.04407\"\>", "Text",
  StripOnInput->False]], "Print",
 CellChangeTimes->{3.7995969729422617`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"9de92e75-8f8f-4796-b735-a0e1caec48da"],

Cell[BoxData[
 StyleBox["\<\" \[Bullet] V. Shtabovenko, R. Mertig and F. Orellana, Comput. \
Phys. Commun., 207, 432-444, 2016, arXiv:1601.01167\"\>", "Text",
  StripOnInput->False]], "Print",
 CellChangeTimes->{3.799596972944498*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"c8ea221f-4cb5-47eb-a834-8003a0f8c855"],

Cell[BoxData[
 StyleBox["\<\" \[Bullet] R. Mertig, M. B\[ODoubleDot]hm, and A. Denner, \
Comput. Phys. Commun., 64, 345-359, 1991.\"\>", "Text",
  StripOnInput->False]], "Print",
 CellChangeTimes->{3.79959697294646*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"b7d17f7f-2dd3-4e68-8a53-2d9b9be3004e"]
}, Open  ]]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "qgraphtGeneration", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"qgraphGeneration", "[", 
   RowBox[{
   "inParticles_List", ",", " ", "outParticles_List", ",", 
    "loopNumber_Integer", ",", "outputName_String", ",", 
    "propagatorCount_Association", ",", 
    RowBox[{"verbose_:", "True"}]}], "]"}], ":=", "\[IndentingNewLine]", "\t", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "preamble", ",", "instates", ",", "outstates", ",", "loops", ",", 
      "props", ",", "datfile"}], "}"}], ",", "\[IndentingNewLine]", "\t\t", 
    RowBox[{
     RowBox[{"preamble", "=", 
      RowBox[{
      "\"\<output='\>\"", "<>", "outputName", "<>", 
       "\"\<';\\nstyle='../../uvCT.sty';\\nmodel='./minQCDQEDH.mod';\\n\>\""}]\
}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"instates", "=", "\"\<in=\>\""}], ";", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t\t", 
      RowBox[{
       RowBox[{"instates", "=", 
        RowBox[{"instates", "<>", "\"\< \>\"", "<>", 
         RowBox[{"inParticles", "[", 
          RowBox[{"[", "ii", "]"}], "]"}], "<>", "\"\<[p\>\"", "<>", 
         RowBox[{"ToString", "@", "ii"}], "<>", "\"\<],\>\""}]}], 
       "\[IndentingNewLine]", "\t\t", ",", 
       RowBox[{"{", 
        RowBox[{"ii", ",", 
         RowBox[{"Length", "@", "inParticles"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"instates", "=", 
      RowBox[{
       RowBox[{"StringDrop", "[", 
        RowBox[{"instates", ",", 
         RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\t\t", "\n", "\t\t", 
     RowBox[{"outstates", "=", "\"\<out=\>\""}], ";", "\[IndentingNewLine]", 
     "\t\t", 
     RowBox[{"Do", "[", "\n", "\t\t\t", 
      RowBox[{
       RowBox[{"outstates", "=", 
        RowBox[{"outstates", "<>", "\"\< \>\"", "<>", 
         RowBox[{"outParticles", "[", 
          RowBox[{"[", "ii", "]"}], "]"}], "<>", "\"\<[p\>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"(", 
           RowBox[{"ii", "+", 
            RowBox[{"Length", "@", "inParticles"}]}], ")"}]}], "<>", 
         "\"\<],\>\""}]}], "\[IndentingNewLine]", "\t\t", ",", 
       RowBox[{"{", 
        RowBox[{"ii", ",", 
         RowBox[{"Length", "@", "outParticles"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "\t\t", 
     RowBox[{"outstates", "=", 
      RowBox[{
       RowBox[{"StringDrop", "[", 
        RowBox[{"outstates", ",", 
         RowBox[{"-", "1"}]}], "]"}], "<>", "\"\<;\\n\>\""}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"loops", "=", 
      RowBox[{"\"\<loops=\>\"", "<>", 
       RowBox[{"ToString", "@", "loopNumber"}], "<>", 
       "\"\<;\\nloop_momentum=k;\\noptions=onshell,notadpole,nosnail, \
onepi;\\n\>\""}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"props", "=", "\"\<\>\""}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t\t", 
      RowBox[{
       RowBox[{"props", "=", 
        RowBox[{
        "props", "<>", "\"\<true=iprop[\>\"", "<>", "part", "<>", "\"\<,\>\"",
          "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"propagatorCount", "[", 
           RowBox[{"[", "part", "]"}], "]"}]}], "<>", "\"\<,\>\"", "<>", 
         RowBox[{"ToString", "@", 
          RowBox[{"propagatorCount", "[", 
           RowBox[{"[", "part", "]"}], "]"}]}], "<>", "\"\<];\\n\>\""}]}], 
       "\[IndentingNewLine]", "\t\t", ",", 
       RowBox[{"{", 
        RowBox[{"part", ",", 
         RowBox[{"Keys", "@", "propagatorCount"}]}], "}"}]}], "]"}], ";", 
     "\n", "\t\t", 
     RowBox[{"datfile", "=", 
      RowBox[{
      "preamble", "<>", "instates", "<>", "outstates", "<>", "loops", "<>", 
       "props"}]}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Export", "[", 
      RowBox[{
      "\"\<./ct_graph_generation/qgraf.dat\>\"", ",", "datfile", ",", 
       "\"\<Text\>\""}], "]"}], ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"Run", "[", 
      RowBox[{
      "\"\<cd ./ct_graph_generation && rm -rf \>\"", "<>", "outputName", 
       "<>", "\"\< a.out && gfortran qgraf-3.4.2.f && ./a.out\>\""}], "]"}], 
     ";", "\[IndentingNewLine]", "\t\t", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"verbose", "\[Equal]", "True"}], ",", "\[IndentingNewLine]", 
       "\t\t\t", 
       RowBox[{"Print", "@", "datfile"}]}], "\[IndentingNewLine]", "\t\t", 
      "]"}], ";"}]}], "\[IndentingNewLine]", "]"}]}]}], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.79930676957156*^9, 3.7993068881166162`*^9}, {
   3.799306925915031*^9, 3.7993072583751173`*^9}, {3.799307691096024*^9, 
   3.7993078385187397`*^9}, {3.7993080987281513`*^9, 3.799308462254612*^9}, {
   3.799308495083206*^9, 3.799308795188995*^9}, {3.7993089770793667`*^9, 
   3.799308983182184*^9}, {3.799309015057559*^9, 3.7993090678073177`*^9}, {
   3.799309097897069*^9, 3.7993092616624327`*^9}, {3.799309463052515*^9, 
   3.799309499916503*^9}, {3.799309550165099*^9, 3.7993096638155107`*^9}, {
   3.799310986479952*^9, 3.7993109975259533`*^9}, {3.799317518820016*^9, 
   3.7993175210885143`*^9}, {3.799317604820311*^9, 3.799317658138837*^9}, {
   3.799579615694009*^9, 3.799579724420816*^9}, 3.79959697258644*^9},
 CellLabel->"In[2]:=",ExpressionUUID->"eff442ce-59c1-49ad-abc9-b85ce6446913"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "getUVprocess", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"getUVprocess", "[", 
   RowBox[{
   "inParticles_List", ",", " ", "outParticles_List", ",", 
    "loopNumber_Integer", ",", "outputName_String", ",", 
    "propagatorCount_Association", ",", 
    RowBox[{"verbose_:", "True"}]}], "]"}], ":=", 
  RowBox[{"Block", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"graphs", ",", "fullNumerator", ",", "lo"}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"qgraphGeneration", "[", 
      RowBox[{
      "inParticles", ",", " ", "outParticles", ",", "loopNumber", ",", 
       "outputName", ",", "propagatorCount", ",", "verbose"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"graphs", "=", 
      RowBox[{"importGraphs", "[", 
       RowBox[{
        RowBox[{"\"\<./ct_graph_generation/\>\"", "<>", "outputName"}], ",", 
        RowBox[{"sumIsoGraphs", "\[Rule]", "False"}]}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"qgraphGeneration", "[", 
      RowBox[{"inParticles", ",", " ", "outParticles", ",", "0", ",", 
       RowBox[{"outputName", "<>", "\"\<LO\>\""}], ",", "propagatorCount", 
       ",", "verbose"}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Do", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"lo", "=", 
         RowBox[{"Association", "@", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{
             RowBox[{"\"\<tree_level_numerator\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{"v", "@@", 
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"graphs", "[", 
                   RowBox[{"[", 
                    RowBox[{"gg", ",", "\"\<numerator\>\""}], "]"}], "]"}], 
                  ",", 
                  RowBox[{"Alternatives", "@@", 
                   RowBox[{"{", 
                    RowBox[{"_in", ",", "_out"}], "}"}]}], ",", "Infinity"}], 
                 "]"}]}], ")"}]}], "/.", " ", 
             RowBox[{
              RowBox[{"in", "[", "x___", "]"}], "\[RuleDelayed]", "x"}]}], 
            " ", "/.", " ", 
            RowBox[{
             RowBox[{"out", "[", "x___", "]"}], "\[RuleDelayed]", "x"}]}], 
           ")"}]}]}], ";", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"graphs", "[", 
          RowBox[{"[", "gg", "]"}], "]"}], "=", 
         RowBox[{"Append", "[", 
          RowBox[{
           RowBox[{"graphs", "[", 
            RowBox[{"[", "gg", "]"}], "]"}], ",", "lo"}], "]"}]}], ";"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"{", 
        RowBox[{"gg", ",", 
         RowBox[{"Length", "@", "graphs"}]}], "}"}]}], "]"}], ";", 
     "\[IndentingNewLine]", "graphs"}]}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "]"}]}]}], "Input",
 CellChangeTimes->CompressedData["
1:eJwdxU9EQ3EAB/BnGx0aS0SjS48uSerpMNpMu5TWH1tWVErLS7doXUZ/9G9W
3ukxaS1bf/SXLbXpMEXU23TIZE9rjN5SLcqsmIym37fDx6faOmFmZRRFqQms
aWcM7q6PFnNYbsLZ1gsLzlMdc3irfDSEl9ZjEazo7MvgaE20YoPsO0yrsV45
psd1q3Qvnoq//O94kPoxJ9pH8G1Qy+I9JmTHTX6Jx8WemTU823aziY8qC8f4
eqDb5CF74idmzOuS815ylUgv4F+9m8OT1uVtnMgWT7HvzHaHue/XFDYZ75+w
Zlw37CP7y5ws5pKcDectxhW83yjjcSE15MKXgYMAZnQRAde/J2J4UBJTOLOY
k/CPS/mMP2udb5hOpzO4QesQd8hXgvcRB8/D8l3yl2G6BAuKRCnONatU+A++
pNao
  "],
 CellLabel->"In[4]:=",ExpressionUUID->"f9479580-7ed8-4f2d-a25b-b27be3fac931"],

Cell[BoxData[
 RowBox[{
  RowBox[{"getUVApproximant", "[", "graphs_", "]"}], ":=", 
  RowBox[{"Block", "[", "\[IndentingNewLine]", "\t", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"sdd", ",", 
      RowBox[{"mygraphs", "=", 
       RowBox[{"Flatten", "@", 
        RowBox[{"{", "graphs", "}"}]}]}], ",", "propPos", ",", "loopBasis", 
      ",", "expandPropagators", ",", "propCount", ",", "maxDegree", ",", 
      "projector", ",", "projectedNumerator", ",", "translateToTopos"}], 
     "}"}], ",", "\n", "\t", "\n", "\t", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "wrapper", " ", "for", " ", "doing", " ", "the", " ", "uv", " ", 
       "tensor"}], "-", 
      RowBox[{
      "projection", " ", "at", " ", "a", " ", "given", " ", "rank"}]}], 
     "*)"}], "\t", "\[IndentingNewLine]", "\t", 
    RowBox[{
     RowBox[{
      RowBox[{"projector", "[", 
       RowBox[{"myrank_", ",", "loopMomentum_"}], "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
         "projec", ",", "ind", ",", "coeff", ",", "tens", ",", "g", ",", 
          "projectedTensor"}], "}"}], ",", "\[IndentingNewLine]", "\t\t", 
        RowBox[{
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"OddQ", "[", "myrank", "]"}], ",", "\[IndentingNewLine]", 
           "\t\t\t", 
           RowBox[{"Return", "[", "0", "]"}]}], "\[IndentingNewLine]", "\t\t",
           "]"}], ";", "\[IndentingNewLine]", "\t\t", 
         RowBox[{"SetAttributes", "[", 
          RowBox[{"g", ",", "Orderless"}], "]"}], ";", "\[IndentingNewLine]", 
         "\t\t", 
         RowBox[{"ind", "=", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"lMomInd", "[", "1", "]"}], "[", "i", "]"}], ",", 
            RowBox[{"{", 
             RowBox[{"i", ",", "myrank"}], "}"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\t\t", 
         RowBox[{"tens", "=", 
          RowBox[{"(", 
           RowBox[{"DeleteDuplicates", "@", 
            RowBox[{"(", 
             RowBox[{"Times", "@@@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"Apply", "[", 
                  RowBox[{"g", ",", "#", ",", 
                   RowBox[{"{", "1", "}"}]}], "]"}], "&"}], "/@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"ArrayReshape", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{"{", 
                    RowBox[{"2", ",", "2"}], "}"}]}], "]"}], "&"}], "/@", 
                  RowBox[{"Permutations", "[", "ind", "]"}]}], ")"}]}], 
               ")"}]}], ")"}]}], ")"}]}], ";", "\[IndentingNewLine]", "\t\t", 
         
         RowBox[{"projec", "=", 
          RowBox[{"translateToFeynCalc", "[", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"Inverse", "@", 
              RowBox[{"(", 
               RowBox[{"Contract", "[", 
                RowBox[{"translateToFeynCalc", "[", 
                 RowBox[{"KroneckerProduct", "[", 
                  RowBox[{"tens", ",", "tens"}], "]"}], "]"}], "]"}], ")"}]}],
              ")"}], ".", "tens"}], "]"}]}], ";", "\[IndentingNewLine]", 
         "\t\t", 
         RowBox[{"translateToFeynCalc", "[", 
          RowBox[{"tens", ".", 
           RowBox[{"(", 
            RowBox[{"Contract", "[", 
             RowBox[{"translateToFeynCalc", "[", 
              RowBox[{"projec", "*", 
               RowBox[{"(", 
                RowBox[{"Product", "[", 
                 RowBox[{
                  RowBox[{"vector", "[", 
                   RowBox[{"loopMomentum", ",", "i"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"i", ",", "ind"}], "}"}]}], "]"}], ")"}]}], "]"}], 
             "]"}], ")"}]}], "]"}]}]}], "\[IndentingNewLine]", "\t", "]"}]}], 
     ";", "\n", "\t", "\n", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{
      "function", " ", "for", " ", "translating", " ", "to", " ", "scalar", 
       " ", "products", " ", "to", " ", 
       RowBox[{"topologies", ":", " ", 
        RowBox[{
         RowBox[{"maybe", " ", "rework", " ", "for", " ", "2"}], "-", 
         RowBox[{"loop", " ", "needed", 
          RowBox[{"(", "?", ")"}]}]}]}]}], " ", "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"translateToTopos", "[", "uvgraph_", "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{"finalGraph", ",", 
          RowBox[{"graphsUV", "=", 
           RowBox[{"uvgraph", "[", 
            RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}]}], ",", "sps", ",",
           "props", ",", "dd", ",", "eqs", ",", "sols", ",", "mUV", ",", "tp",
           ",", "num"}], "}"}], ",", "\[IndentingNewLine]", "\t\t", 
        RowBox[{
         RowBox[{"num", "=", "0"}], ";", "\n", "\t\t", 
         RowBox[{"Do", "[", "\n", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"sps", "=", 
             RowBox[{
              RowBox[{"Cases", "[", 
               RowBox[{
                RowBox[{"graph", "[", 
                 RowBox[{"[", "\"\<uv_topo\>\"", "]"}], "]"}], ",", "_Pair", 
                ",", "Infinity"}], "]"}], "//", "Union"}]}], ";", 
            "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"props", "=", 
             RowBox[{"Array", "[", 
              RowBox[{"dd", ",", 
               RowBox[{"Length", "@", 
                RowBox[{"graph", "[", 
                 RowBox[{"[", "\"\<uv_topo\>\"", "]"}], "]"}]}]}], "]"}]}], 
            ";", "\n", "\t\t\t", 
            RowBox[{"eqs", "=", 
             RowBox[{"Thread", "@", 
              RowBox[{"(", 
               RowBox[{"Equal", "[", 
                RowBox[{"props", ",", 
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<uv_topo\>\"", "]"}], "]"}], "/.", " ", 
                   RowBox[{
                    RowBox[{"uvProp", "[", 
                    RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
                    RowBox[{"a", "-", 
                    RowBox[{"mUV", "^", "2"}]}]}]}], ")"}]}], "]"}], 
               ")"}]}]}], ";", "\n", "\t\t\t", 
            RowBox[{"tp", "=", 
             RowBox[{"(", 
              RowBox[{"ToExpression", "@", 
               RowBox[{"(", 
                RowBox[{"\"\<topo\>\"", "<>", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"(", 
                   RowBox[{"Length", "@", 
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<uv_topo\>\"", "]"}], "]"}]}], ")"}]}]}],
                 ")"}]}], ")"}]}], ";", "\n", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{
             "solve", " ", "SPs", " ", "in", " ", "terms", " ", "of", " ", 
              "denominators"}], " ", "*)"}], "\n", "\t\t\t", 
            RowBox[{"sols", "=", 
             RowBox[{"Flatten", "@", 
              RowBox[{"(", 
               RowBox[{"Solve", "[", 
                RowBox[{"eqs", ",", "sps"}], "]"}], ")"}]}]}], ";", "\n", 
            "\t\t\t", 
            RowBox[{"num", "=", 
             RowBox[{"num", "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<numerator\>\"", "]"}], "]"}], "//.", 
                    "sols"}], ")"}], "*", 
                    RowBox[{"tp", "@", 
                    RowBox[{"(", 
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<prop_powers\>\"", "]"}], "]"}], 
                    ")"}]}]}], "//", "Expand"}], ")"}], "//.", " ", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"tp", "[", "x_List", "]"}], 
                   RowBox[{"dd", "[", "y_", "]"}]}], ":>", 
                  RowBox[{"tp", "@", 
                   RowBox[{"(", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"x", ",", " ", 
                    RowBox[{"y", " ", "->", " ", 
                    RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "y", "]"}], "]"}], "-", "1"}]}]}], "]"}], 
                    ")"}]}]}]}], "//.", 
                RowBox[{
                 RowBox[{
                  RowBox[{"tp", "[", "x_List", "]"}], 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"dd", "[", "y_", "]"}], "^", "a_"}], ")"}]}], ":>", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"dd", "[", "y", "]"}], "^", 
                   RowBox[{"(", 
                    RowBox[{"a", "-", "1"}], ")"}]}], 
                  RowBox[{"tp", "@", 
                   RowBox[{"(", 
                    RowBox[{"ReplacePart", "[", 
                    RowBox[{"x", ",", " ", 
                    RowBox[{"y", " ", "->", " ", 
                    RowBox[{
                    RowBox[{"x", "[", 
                    RowBox[{"[", "y", "]"}], "]"}], "-", "1"}]}]}], "]"}], 
                    ")"}]}]}]}]}], ")"}]}]}], ";", "\n", "\t\t\t", 
            RowBox[{"num", "=", 
             RowBox[{"num", "/.", 
              RowBox[{
               RowBox[{"tp", "[", "x_List", "]"}], "\[RuleDelayed]", 
               RowBox[{"tp", "@@", "x"}]}]}]}], ";", "\n", "\t\t\t", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"!", 
               RowBox[{"FreeQ", "[", 
                RowBox[{"num", ",", 
                 RowBox[{"Alternatives", "@@", 
                  RowBox[{"graph", "[", 
                   RowBox[{"[", "\"\<loopMomenta\>\"", "]"}], "]"}]}]}], 
                "]"}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<Did not manage to express everything in terms of scalar \
topologies.\>\"", "]"}], ";", "\n", "\t\t\t\t", 
               RowBox[{"Abort", "[", "]"}]}]}], "\n", "\t\t\t", "]"}]}], "\n",
            "\t\t", ",", 
           RowBox[{"{", 
            RowBox[{"graph", ",", "graphsUV"}], "}"}]}], "]"}], ";", "\n", 
         "\t\t", 
         RowBox[{"finalGraph", "=", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{"uvgraph", ",", "\"\<uv_graphs\>\""}], "]"}]}], ";", "\n", 
         "\t\t", 
         RowBox[{"finalGraph", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"finalGraph", ",", 
            RowBox[{"Association", "@", 
             RowBox[{"(", 
              RowBox[{"\"\<analytic_uv_ct\>\"", "\[Rule]", 
               RowBox[{"Simplify", "@", "num"}]}], ")"}]}]}], "]"}]}]}]}], 
       "\n", "\t", "]"}]}], ";", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", "\n", "\t", 
     RowBox[{"(*", " ", 
      RowBox[{"wrapper", " ", "to", " ", "expand", " ", "numerators"}], " ", 
      "*)"}], "\n", "\t", 
     RowBox[{
      RowBox[{"expandPropagators", "[", "uvgraph_", "]"}], ":=", 
      RowBox[{"Block", "[", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"graph", "=", "uvgraph"}], ",", "uvexpandedNumerator", ",", 
          "topo", ",", "uvAsso", ",", "props", ",", "uvProp", ",", "lambdaUV",
           ",", "uvExpansion", ",", "referenceTopo", ",", "uvG"}], "}"}], ",",
         "\[IndentingNewLine]", "\t\t", 
        RowBox[{
         RowBox[{"uvAsso", "=", 
          RowBox[{"graph", "[", 
           RowBox[{"[", 
            RowBox[{"{", "\"\<uv_info\>\"", "}"}], "]"}], "]"}]}], ";", "\n", 
         "\t\t", 
         RowBox[{"graph", "=", 
          RowBox[{"KeyDrop", "[", 
           RowBox[{"graph", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<uv_info\>\"", ",", "\"\<analyticTensorCoeff\>\""}], 
             "}"}]}], "]"}]}], ";", "\t", "\n", "\t\t", 
         RowBox[{"graph", "=", 
          RowBox[{"Append", "[", 
           RowBox[{"graph", ",", 
            RowBox[{"Association", "@", 
             RowBox[{"(", 
              RowBox[{"\"\<uv_graphs\>\"", "\[Rule]", 
               RowBox[{"{", "}"}]}], ")"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\t\t", 
         RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{"(*", " ", 
           RowBox[{
            RowBox[{
            "we", " ", "dont", " ", "take", " ", "masses", " ", "into", " ", 
             "account"}], ",", " ", 
            RowBox[{
            "since", " ", "the", " ", "CT", " ", "will", " ", "simply", " ", 
             "be", " ", "the", " ", "original", " ", "diagram", " ", 
             "expanded", " ", "around", " ", "vanininshing", " ", "momenta"}],
             ",", " ", 
            RowBox[{
             RowBox[{"and", " ", "then", " ", "we", " ", "IR"}], "-", 
             "regulate"}]}], " ", "*)"}], "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{
           RowBox[{
            RowBox[{"props", "=", 
             RowBox[{"Cases", "[", 
              RowBox[{
               RowBox[{"graph", "[", 
                RowBox[{"[", "\"\<momentumMap\>\"", "]"}], "]"}], ",", 
               RowBox[{"x_", "/;", 
                RowBox[{"!", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"x", ",", 
                   RowBox[{"Alternatives", "@@", 
                    RowBox[{"(", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"(", 
                    RowBox[{"Keys", "@", "expansion"}], ")"}]}], ")"}]}]}], 
                  "]"}]}]}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t\t\t", 
            
            RowBox[{"(*", " ", 
             RowBox[{"uv", "-", "scaling"}], " ", "*)"}], 
            "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"referenceTopo", "=", 
             RowBox[{
              RowBox[{
               RowBox[{"uvProp", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"SPD", "[", 
                   RowBox[{"#", ",", "#"}], "]"}], "//", 
                  "ExpandScalarProduct"}], ",", "1"}], "]"}], "&"}], "/@", 
              RowBox[{"(", 
               RowBox[{"Flatten", "@", 
                RowBox[{"(", 
                 RowBox[{"Keys", "@", "expansion"}], ")"}]}], ")"}]}]}], ";", 
            "\n", "\t\t\t", 
            RowBox[{"props", "=", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"Times", "@@", 
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"uvProp", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"SPD", "[", 
                    RowBox[{"#", ",", "#"}], "]"}], "//", 
                    "ExpandScalarProduct"}], ",", "1"}], "]"}], "&"}], "/@", 
                  "props"}], ")"}]}], ")"}], "/.", " ", 
              RowBox[{
               RowBox[{"Pair", "[", 
                RowBox[{
                 RowBox[{"Momentum", "[", 
                  RowBox[{"x_", ",", "D"}], "]"}], ",", 
                 RowBox[{"Momentum", "[", 
                  RowBox[{"y_", ",", "D"}], "]"}]}], "]"}], "\[RuleDelayed]", 
               
               RowBox[{
                SuperscriptBox["lambdaUV", 
                 RowBox[{"Length", "@", 
                  RowBox[{"(", 
                   RowBox[{"DeleteCases", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{"x", ",", "y"}], "}"}], ",", 
                    RowBox[{"Alternatives", "@@", 
                    RowBox[{"(", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"(", 
                    RowBox[{"Keys", "@", "expansion"}], ")"}]}], ")"}]}]}], 
                    "]"}], ")"}]}]], 
                RowBox[{"Pair", "[", 
                 RowBox[{
                  RowBox[{"Momentum", "[", 
                   RowBox[{"x", ",", "D"}], "]"}], ",", 
                  RowBox[{"Momentum", "[", 
                   RowBox[{"y", ",", "D"}], "]"}]}], "]"}]}]}]}]}], " ", ";", 
            "\t\t\t\t\t\t", "\n", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{"expand", " ", "for", " ", "vanishing", " ", "momenta"}],
              " ", "*)"}], "\[IndentingNewLine]", "\t\t\t", 
            RowBox[{"uvExpansion", "=", 
             RowBox[{"Normal", "@", 
              RowBox[{"Series", "[", 
               RowBox[{"props", ",", 
                RowBox[{"{", 
                 RowBox[{"lambdaUV", ",", "0", ",", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{"Values", "@", "expansion"}], ")"}], "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "}"}]}], "]"}]}]}], ";", 
            "\n", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{
             "replace", " ", "derivative", " ", "of", " ", "propagators"}], 
             " ", "*)"}], "\n", "\t\t\t", 
            RowBox[{"uvExpansion", "=", 
             RowBox[{
              RowBox[{"uvExpansion", " ", "/.", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"Derivative", "[", 
                   RowBox[{"a_", ",", "0"}], "]"}], "[", "uvProp", "]"}], "[", 
                 RowBox[{"x_", ",", "n_Integer"}], "]"}], "\[RuleDelayed]", 
                RowBox[{
                 RowBox[{"Factorial", "[", "a", "]"}], 
                 SuperscriptBox[
                  RowBox[{"(", 
                   RowBox[{"-", "1"}], ")"}], "a"], 
                 RowBox[{
                  RowBox[{"uvProp", "[", 
                   RowBox[{"x", ",", "n"}], "]"}], "^", 
                  RowBox[{"(", 
                   RowBox[{"a", "+", "1"}], ")"}]}]}]}]}], "/.", " ", 
              RowBox[{"lambdaUV", "\[Rule]", "1"}]}]}], ";", "\n", "\t\t\t", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{
              "small", " ", "sanity", " ", "check", " ", "of", " ", "the", 
               " ", "number", " ", "of", " ", "UV"}], "-", "propagators"}], 
             "*)"}], "\n", "\t\t\t", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Complement", "[", 
                RowBox[{
                 RowBox[{"Union", "@", 
                  RowBox[{"(", 
                   RowBox[{"Cases", "[", 
                    RowBox[{"uvExpansion", ",", "_uvProp", ",", "Infinity"}], 
                    "]"}], ")"}]}], ",", "referenceTopo"}], "]"}], "=!=", 
               RowBox[{"{", "}"}]}], ",", "\n", "\t\t\t\t", 
              RowBox[{
               RowBox[{
               "Print", "[", 
                "\"\<There is a mismatch between the reference topology and \
the UV-approximant\>\"", "]"}], ";", "\n", "\t\t\t\t", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<The reference topo is: \>\"", "<>", 
                 RowBox[{"ToString", "@", "referenceTopo"}]}], "]"}], ";", 
               "\n", "\t\t\t\t", 
               RowBox[{"Print", "[", 
                RowBox[{"\"\<The expanded propagators are : \>\"", "<>", 
                 RowBox[{"ToString", "@", 
                  RowBox[{"(", 
                   RowBox[{"Union", "@", 
                    RowBox[{"(", 
                    RowBox[{"Cases", "[", 
                    RowBox[{"uvExpansion", ",", "_uvProp", ",", "Infinity"}], 
                    "]"}], ")"}]}], ")"}]}]}], "]"}], ";", "\n", "\t\t\t\t", 
               RowBox[{"Abort", "[", "]"}]}]}], "\n", "\t\t\t\t", "]"}], ";", 
            "\t\t\t", "\n", "\t\t\t", 
            RowBox[{"uvExpansion", "=", 
             RowBox[{"CoefficientRules", "[", 
              RowBox[{"uvExpansion", ",", "referenceTopo"}], "]"}]}], ";", 
            "\n", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{
              RowBox[{"overwrite", " ", "uv"}], "-", "info"}], " ", "*)"}], 
            "\n", "\t\t\t", 
            RowBox[{"Do", "[", "\t\t\t", "\[IndentingNewLine]", "\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"graph", "[", 
                RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "=", 
               RowBox[{"Append", "[", 
                RowBox[{
                 RowBox[{"graph", "[", 
                  RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], ",", "\n", 
                 "\t\t\t\t\t", 
                 RowBox[{"Association", "@", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"Association", "@", 
                    RowBox[{"(", 
                    RowBox[{"\"\<loopMomenta\>\"", "\[Rule]", 
                    RowBox[{"Variables", "@", 
                    RowBox[{"(", 
                    RowBox[{"Flatten", "@", 
                    RowBox[{"(", 
                    RowBox[{"Keys", "@", "expansion"}], ")"}]}], ")"}]}]}], 
                    ")"}]}], ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"Association", "@", 
                    RowBox[{"(", 
                    RowBox[{"\"\<uv_topo\>\"", "\[Rule]", "referenceTopo"}], 
                    ")"}]}], ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"Association", "@", 
                    RowBox[{"(", 
                    RowBox[{"\"\<prop_powers\>\"", "\[Rule]", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Keys", "@", "uvExpansion"}], ")"}], "[", 
                    RowBox[{"[", "count", "]"}], "]"}]}], ")"}]}], ",", "\n", 
                    "\t\t\t\t\t", 
                    RowBox[{"Association", "@", 
                    RowBox[{"(", 
                    RowBox[{"\"\<numerator\>\"", "->", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"Values", "@", "uvExpansion"}], ")"}], "[", 
                    RowBox[{"[", "count", "]"}], "]"}], "*", 
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<numerator\>\"", "]"}], "]"}]}]}], 
                    ")"}]}], ",", "\n", "\t\t\t\t\t", 
                    RowBox[{"Association", "@", 
                    RowBox[{"(", 
                    RowBox[{"\"\<momentumMap\>\"", "\[Rule]", 
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<momentumMap\>\"", "]"}], "]"}]}], 
                    ")"}]}]}], "\n", "\t\t\t\t", "}"}]}]}], "]"}]}], "\n", 
              "\t\t\t", ",", 
              RowBox[{"{", 
               RowBox[{"count", ",", 
                RowBox[{"Length", "@", "uvExpansion"}]}], "}"}]}], "]"}], ";",
             "\n", "\t\t\t", 
            RowBox[{"(*", " ", 
             RowBox[{"project", " ", "numerator"}], " ", "*)"}], "\n", 
            "\t\t\t", 
            RowBox[{"Do", "[", "\n", "\t\t\t\t", 
             RowBox[{
              RowBox[{
               RowBox[{"uvG", "=", 
                RowBox[{"extractTensCoeff", "[", 
                 RowBox[{
                  RowBox[{"graph", "[", 
                   RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "[", 
                  RowBox[{"[", "uvCount", "]"}], "]"}], "]"}]}], ";", "\n", 
               "\t\t\t\t", 
               RowBox[{"projectedNumerator", "=", 
                RowBox[{"(", 
                 RowBox[{"Plus", "@@", 
                  RowBox[{"(", 
                   RowBox[{"DiracSimplify", "@", 
                    RowBox[{"(", 
                    RowBox[{"Contract", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Times", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{"projector", "[", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"uvG", "[", 
                    RowBox[{"[", 
                    RowBox[{"\"\<loopMomenta\>\"", ",", "1"}], "]"}], "]"}]}],
                     "]"}]}], "]"}], "&"}], "/@", 
                    RowBox[{"(", 
                    RowBox[{"uvG", "[", 
                    RowBox[{"[", "\"\<analyticTensorCoeff\>\"", "]"}], "]"}], 
                    ")"}]}], "]"}], ")"}]}], ")"}]}], ")"}]}], ";", "\n", 
               "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"graph", "[", 
                  RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "[", 
                 RowBox[{"[", "uvCount", "]"}], "]"}], "=", 
                RowBox[{"KeyDrop", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "[", 
                   RowBox[{"[", "uvCount", "]"}], "]"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"\"\<momentumMap\>\"", ",", "\"\<numerator\>\""}], 
                   "}"}]}], "]"}]}], ";", "\n", "\t\t\t\t", 
               RowBox[{
                RowBox[{
                 RowBox[{"graph", "[", 
                  RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "[", 
                 RowBox[{"[", "uvCount", "]"}], "]"}], "=", 
                RowBox[{"Append", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}], "[", 
                   RowBox[{"[", "uvCount", "]"}], "]"}], ",", 
                  RowBox[{"Association", "@", 
                   RowBox[{"(", 
                    RowBox[{
                    "\"\<numerator\>\"", "\[Rule]", "projectedNumerator"}], 
                    ")"}]}]}], "]"}]}], ";"}], "\n", "\t\t\t\t", "\n", 
              "\t\t\t", ",", 
              RowBox[{"{", 
               RowBox[{"uvCount", ",", 
                RowBox[{"Length", "@", 
                 RowBox[{"graph", "[", 
                  RowBox[{"[", "\"\<uv_graphs\>\"", "]"}], "]"}]}]}], "}"}]}],
              "]"}]}], "\n", "\t\t", ",", 
           RowBox[{"{", 
            RowBox[{"expansion", ",", "uvAsso"}], "}"}]}], "]"}], ";", "\n", 
         "\t\t", "graph"}]}], "\[IndentingNewLine]", "\t", "]"}]}], ";", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", "\t", 
     "\[IndentingNewLine]", "\t", 
     RowBox[{"Table", "[", "\[IndentingNewLine]", "\t\t", 
      RowBox[{
       RowBox[{
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{"!", 
           RowBox[{"KeyExistsQ", "[", 
            RowBox[{"graph", ",", "\"\<analyticTensorCoeff\>\""}], "]"}]}], 
          ",", "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{"graph", "=", 
           RowBox[{"extractTensCoeff", "[", "graph", "]"}]}]}], 
         "\[IndentingNewLine]", "\t\t", "]"}], ";", "\[IndentingNewLine]", 
        "\t\t", 
        RowBox[{"loopBasis", "=", 
         RowBox[{
          RowBox[{"Subsets", "[", 
           RowBox[{"graph", "[", 
            RowBox[{"[", "\"\<loopMomenta\>\"", "]"}], "]"}], "]"}], "/.", 
          " ", 
          RowBox[{
           RowBox[{"{", "}"}], "\[Rule]", "Nothing"}]}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"If", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Length", "@", "loopBasis"}], ">", "1"}], ",", 
          "\[IndentingNewLine]", "\t\t\t", 
          RowBox[{
           RowBox[{
           "Print", "[", "\"\<Only one-loop implemented so far\>\"", "]"}], 
           ";", "\[IndentingNewLine]", "\t\t\t", 
           RowBox[{"Abort", "[", "]"}]}]}], "\[IndentingNewLine]", "\t\t", 
         "]"}], ";", "\n", "\t\t", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"graph", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"graph", ",", 
           RowBox[{"Association", "@", 
            RowBox[{"(", 
             RowBox[{"\"\<uv_info\>\"", "\[Rule]", 
              RowBox[{"<|", "|>"}]}], ")"}]}]}], "]"}]}], ";", "\n", "\t\t", 
        RowBox[{"maxDegree", "=", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Max", "@", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"graph", "[", 
               RowBox[{"[", "\"\<analyticTensorCoeff\>\"", "]"}], "]"}], "[", 
              
              RowBox[{"[", 
               RowBox[{"All", ",", "1", ",", "kk"}], "]"}], "]"}], ")"}]}], 
           ",", 
           RowBox[{"{", 
            RowBox[{"kk", ",", 
             RowBox[{"Length", "@", 
              RowBox[{"(", 
               RowBox[{"graph", "[", 
                RowBox[{"[", "\"\<loopMomenta\>\"", "]"}], "]"}], ")"}]}]}], 
            "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\t\t", 
        RowBox[{"Do", "[", "\[IndentingNewLine]", "\t\t\t", 
         RowBox[{
          RowBox[{
           RowBox[{"propCount", "=", 
            RowBox[{"Length", "@", 
             RowBox[{"Position", "[", 
              RowBox[{
               RowBox[{"graph", "[", 
                RowBox[{"[", "\"\<momentumMap\>\"", "]"}], "]"}], ",", 
               RowBox[{"x_", "/;", 
                RowBox[{"!", 
                 RowBox[{"FreeQ", "[", 
                  RowBox[{"x", ",", 
                   RowBox[{"Alternatives", "@@", "ll"}]}], "]"}]}]}], ",", 
               "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", "\t\t\t", 
           RowBox[{"sdd", "=", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"4", "*", 
               RowBox[{"Length", "@", "ll"}]}], "-", 
              RowBox[{"2", "*", "propCount"}], " ", "+", " ", 
              RowBox[{"Total", "@@", 
               RowBox[{"(", 
                RowBox[{"Extract", "[", 
                 RowBox[{"maxDegree", ",", 
                  RowBox[{"Position", "[", 
                   RowBox[{
                    RowBox[{"graph", "[", 
                    RowBox[{"[", "\"\<loopMomenta\>\"", "]"}], "]"}], ",", 
                    RowBox[{"x_", "/;", 
                    RowBox[{"!", 
                    RowBox[{"FreeQ", "[", 
                    RowBox[{"x", ",", 
                    RowBox[{"Alternatives", "@@", "ll"}]}], "]"}]}]}], ",", 
                    RowBox[{"Heads", "\[Rule]", "False"}]}], "]"}]}], "]"}], 
                ")"}]}]}], ")"}]}], ";", "\t\t\t", "\n", "\t\t\t", 
           RowBox[{
            RowBox[{"graph", "[", 
             RowBox[{"[", "\"\<uv_info\>\"", "]"}], "]"}], "=", 
            RowBox[{"Append", "[", 
             RowBox[{
              RowBox[{"graph", "[", 
               RowBox[{"[", "\"\<uv_info\>\"", "]"}], "]"}], ",", 
              RowBox[{"Association", "@", 
               RowBox[{"(", 
                RowBox[{"ll", "\[Rule]", "sdd"}], ")"}]}]}], "]"}]}], ";"}], 
          "\t\t\t\t", "\[IndentingNewLine]", "\t\t", ",", 
          RowBox[{"{", 
           RowBox[{"ll", ",", "loopBasis"}], "}"}]}], "]"}], ";", "\n", 
        "\t\t", 
        RowBox[{"graph", "=", 
         RowBox[{"expandPropagators", "[", "graph", "]"}]}], ";", 
        "\[IndentingNewLine]", "\t\t", 
        RowBox[{"graph", "=", 
         RowBox[{"translateToTopos", "[", "graph", "]"}]}]}], 
       "\[IndentingNewLine]", "\t", ",", 
       RowBox[{"{", 
        RowBox[{"graph", ",", "mygraphs"}], "}"}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}]], "Code",
 InitializationCell->False,
 CellChangeTimes->{{3.799328220511159*^9, 3.799328285191718*^9}, {
   3.799328332778338*^9, 3.799329062285235*^9}, {3.7993291110586643`*^9, 
   3.799329132233014*^9}, {3.799329197521387*^9, 3.799329285957312*^9}, {
   3.7993293222291*^9, 3.799329330406807*^9}, {3.799329394586578*^9, 
   3.799329421405491*^9}, {3.799329829038723*^9, 3.799330052098033*^9}, {
   3.799330084935863*^9, 3.79933030187792*^9}, {3.799330452585725*^9, 
   3.799330574356267*^9}, {3.799330606259801*^9, 3.799330727955926*^9}, {
   3.7993307609949903`*^9, 3.79933080833519*^9}, 3.799330898265654*^9, {
   3.799330955047171*^9, 3.799330972846479*^9}, {3.7993310279083967`*^9, 
   3.799331090223043*^9}, {3.799331136309393*^9, 3.799331218217854*^9}, {
   3.799331255484539*^9, 3.7993312749770308`*^9}, {3.799331627067172*^9, 
   3.799331890176602*^9}, {3.799331922979498*^9, 3.799331960818346*^9}, {
   3.799332031813223*^9, 3.7993321081036167`*^9}, {3.79933226918104*^9, 
   3.799332283308114*^9}, {3.7993323136813927`*^9, 3.799332318732506*^9}, {
   3.799332777697397*^9, 3.799332889969705*^9}, {3.7993329295646057`*^9, 
   3.799332989293087*^9}, {3.799333035585384*^9, 3.799333044071602*^9}, {
   3.799333099253636*^9, 3.799333103329031*^9}, {3.799333412573175*^9, 
   3.7993335863418694`*^9}, {3.799333639374321*^9, 3.799333641742407*^9}, 
   3.799567595536422*^9, {3.799567655145533*^9, 3.7995677824516153`*^9}, {
   3.7995678427704897`*^9, 3.799567873367633*^9}, {3.799579044571149*^9, 
   3.7995791475450163`*^9}, {3.799579437272944*^9, 3.799579580369081*^9}, {
   3.799580220273443*^9, 3.799580305083762*^9}, {3.79958033714817*^9, 
   3.799580475834506*^9}, {3.799580522332971*^9, 3.7995805430791187`*^9}, {
   3.799580594335928*^9, 3.799580609179165*^9}, {3.79958067809408*^9, 
   3.79958068226915*^9}, {3.799580719505962*^9, 3.799580765868393*^9}, {
   3.799580799712655*^9, 3.799580806185417*^9}, {3.799580876582611*^9, 
   3.799580937418263*^9}, 3.799580968597742*^9, {3.799581005492441*^9, 
   3.799581027548233*^9}, {3.799581301487452*^9, 3.799581594851474*^9}, {
   3.799581655838448*^9, 3.799581662406498*^9}, {3.799581704219863*^9, 
   3.799581728876505*^9}, {3.799581763270784*^9, 3.799581764665226*^9}, {
   3.7995818047218437`*^9, 3.7995818846011047`*^9}, {3.799582341620853*^9, 
   3.799582694409956*^9}, {3.7995828252901917`*^9, 3.799582828651413*^9}, 
   3.799582861980991*^9, {3.799582948452498*^9, 3.799582976175428*^9}, {
   3.7995831259339237`*^9, 3.799583128308629*^9}, 3.79958317387178*^9, {
   3.799583432017741*^9, 3.799583478358135*^9}, {3.799583565596126*^9, 
   3.7995836653870773`*^9}, {3.799583943944961*^9, 3.7995839832162113`*^9}, {
   3.79958406059212*^9, 3.799584084474937*^9}, {3.799584527605826*^9, 
   3.799584570139401*^9}, {3.799584609529043*^9, 3.7995847824529676`*^9}, {
   3.7995848207768383`*^9, 3.799585211279269*^9}, {3.799585298299288*^9, 
   3.799585306742688*^9}, {3.799585399005941*^9, 3.799585405857643*^9}, {
   3.799585500862236*^9, 3.799585503890778*^9}, {3.799586887357294*^9, 
   3.7995869122165937`*^9}, {3.7995873416551323`*^9, 3.799587408999619*^9}, {
   3.799587457777502*^9, 3.79958746025205*^9}, {3.7995874910775127`*^9, 
   3.7995876055685863`*^9}, {3.799587693174823*^9, 3.799587715935184*^9}, {
   3.79958776822188*^9, 3.7995878222920647`*^9}, {3.799587866072529*^9, 
   3.7995879693371773`*^9}, {3.799588012460231*^9, 3.799588080764452*^9}, {
   3.799588150553083*^9, 3.7995881812354097`*^9}, {3.7995883224064837`*^9, 
   3.799588356440076*^9}, {3.799589217330344*^9, 3.7995892475857687`*^9}, {
   3.7995893131047564`*^9, 3.799589434559883*^9}, {3.799589552637658*^9, 
   3.799589606109714*^9}, {3.79959030150299*^9, 3.7995903140861673`*^9}, {
   3.7995931402445297`*^9, 3.799593181070178*^9}, {3.799593211986957*^9, 
   3.799593214156012*^9}, {3.799593255392715*^9, 3.799593270042776*^9}, {
   3.799593733891313*^9, 3.7995937716925993`*^9}, {3.799593805226123*^9, 
   3.799593896240282*^9}, {3.799593930509696*^9, 3.799594134863673*^9}, 
   3.799594170894815*^9, {3.799594230474712*^9, 3.799594239692067*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"5be030a6-53f9-4353-8b1f-6bccc26d5a60"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"possible", " ", "values"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"propCount", "=", 
     RowBox[{"Association", "@", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<higgs\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<gluon\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<photon\>\"", "\[Rule]", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<ghost\>\"", "\[Rule]", "0"}], ",", "\n", "\t", 
        RowBox[{"\"\<eminus\>\"", "\[Rule]", "0"}], ",", "\n", "\t", 
        RowBox[{"\"\<higgs\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<ubar\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        
        RowBox[{"\"\<t\>\"", "\[Rule]", "0"}]}], "\[IndentingNewLine]", 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", "\n", 
   RowBox[{
    RowBox[{"propCount", "=", 
     RowBox[{"Association", "@", 
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"\"\<higgs\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<gluon\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<photon\>\"", "\[Rule]", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"\"\<ghost\>\"", "\[Rule]", "0"}], ",", "\n", "\t", 
        RowBox[{"\"\<eminus\>\"", "\[Rule]", "0"}], ",", "\n", "\t", 
        RowBox[{"\"\<higgs\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<u\>\"", "\[Rule]", "0"}], ",", "\[IndentingNewLine]", 
        RowBox[{"\"\<t\>\"", "\[Rule]", "4"}]}], "\[IndentingNewLine]", 
       "}"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tt", "=", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"getUVprocess", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"\"\<gluon\>\"", ",", "\"\<gluon\>\""}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"\"\<higgs\>\"", ",", "\"\<higgs\>\""}], "}"}], ",", "1", 
         ",", "\"\<gammaUUbarNLO.qgr\>\"", ",", "propCount", ",", "False"}], 
        "]"}], ")"}], "[", 
      RowBox[{"[", "1", "]"}], "]"}]}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7995795960728807`*^9, 3.799579596223298*^9}, {
   3.799579745306468*^9, 3.799579814070245*^9}, 3.799589177898294*^9, {
   3.799594286177853*^9, 3.79959428804585*^9}, {3.799594330603075*^9, 
   3.799594379080221*^9}, {3.799594464761191*^9, 3.799594490106805*^9}, {
   3.799594537125404*^9, 3.799594537447105*^9}, {3.799596986390296*^9, 
   3.7995969882146797`*^9}},
 CellLabel->"In[7]:=",ExpressionUUID->"48bc886a-de82-48f1-9241-839d18144b11"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tt", "=", 
   RowBox[{"processNumerator", "[", 
    RowBox[{
    "tt", ",", "\"\<./ct_graph_generation/minFeynRulesQEDQCD.m\>\"", ",", 
     RowBox[{"additionalRules", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"scalarProp", "[", "x__", "]"}], "\[RuleDelayed]", "1"}], 
       "}"}]}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7995795960728807`*^9, 3.799579596223298*^9}, {
   3.799579745306468*^9, 3.799579814070245*^9}, 3.799589177898294*^9, {
   3.799594286177853*^9, 3.79959428804585*^9}, {3.799594330603075*^9, 
   3.7995943688503036`*^9}},
 CellLabel->"In[10]:=",ExpressionUUID->"820bbca2-ca66-4629-9635-f4aeff9f4af3"],

Cell[BoxData[
 RowBox[{
  RowBox[{"testFull", "=", 
   RowBox[{"getUVApproximant", "[", "tt", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7995868419115868`*^9, 3.799586848998391*^9}, {
   3.799586924981884*^9, 3.7995869522748947`*^9}, {3.799587065643302*^9, 
   3.7995870898218317`*^9}, {3.799588093064042*^9, 3.7995880991611423`*^9}, {
   3.799588199729435*^9, 3.799588210364661*^9}, {3.7995882525219603`*^9, 
   3.799588256248437*^9}, {3.7995896151073*^9, 3.799589615196855*^9}, {
   3.7995932283465357`*^9, 3.799593229265848*^9}, 3.7995941448127203`*^9, {
   3.799594824575588*^9, 3.7995948462461033`*^9}, 3.799597058138451*^9},
 CellLabel->"In[12]:=",ExpressionUUID->"a795ee11-62e0-4198-8007-a1a6659c5197"]
},
WindowSize->{2560, 1376},
WindowMargins->{{0, Automatic}, {0, Automatic}},
Magnification:>1.2 Inherited,
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 201, 4, 38, "Input",ExpressionUUID->"7430b8b9-b19a-4e74-a9b9-43795df7ac79"],
Cell[CellGroupData[{
Cell[784, 28, 245, 4, 38, "Input",ExpressionUUID->"4d4c8083-9752-4e77-8071-eccbd0a7ddbe"],
Cell[CellGroupData[{
Cell[1054, 36, 975, 15, 545, "Print",ExpressionUUID->"2e3421f8-8d53-44db-9bdb-d5ad04144798"],
Cell[2032, 53, 2373, 67, 37, "Print",ExpressionUUID->"5b4e9382-fab7-4657-b15a-de481239a631"],
Cell[4408, 122, 1159, 30, 37, "Print",ExpressionUUID->"83f4bf1f-98de-4205-9c71-b0a8b642242a"],
Cell[5570, 154, 1157, 32, 37, "Print",ExpressionUUID->"7d8b3c0c-16dc-4316-ae79-2b9f6ae296dc"],
Cell[6730, 188, 336, 7, 35, "Print",ExpressionUUID->"9de92e75-8f8f-4796-b735-a0e1caec48da"],
Cell[7069, 197, 338, 7, 35, "Print",ExpressionUUID->"c8ea221f-4cb5-47eb-a834-8003a0f8c855"],
Cell[7410, 206, 323, 7, 35, "Print",ExpressionUUID->"b7d17f7f-2dd3-4e68-8a53-2d9b9be3004e"]
}, Open  ]]
}, Open  ]],
Cell[7760, 217, 5485, 119, 802, "Code",ExpressionUUID->"eff442ce-59c1-49ad-abc9-b85ce6446913",
 InitializationCell->False],
Cell[13248, 338, 3417, 82, 347, "Input",ExpressionUUID->"f9479580-7ed8-4f2d-a25b-b27be3fac931"],
Cell[16668, 422, 35533, 781, 2866, "Code",ExpressionUUID->"5be030a6-53f9-4353-8b1f-6bccc26d5a60",
 InitializationCell->False],
Cell[52204, 1205, 2714, 55, 683, "Input",ExpressionUUID->"48bc886a-de82-48f1-9241-839d18144b11"],
Cell[54921, 1262, 689, 15, 38, "Input",ExpressionUUID->"820bbca2-ca66-4629-9635-f4aeff9f4af3"],
Cell[55613, 1279, 714, 11, 71, "Input",ExpressionUUID->"a795ee11-62e0-4198-8007-a1a6659c5197"]
}
]
*)

